:m +Control.Exception

-- Disable showing summaries of the call stack for more reproducible tests.
H.performR ([r| options('showErrorCalls'=FALSE) |] >> return ())

H.performR ([r| plot() |] >> return () :: R s ()) `Control.Exception.catch` (\(H.RError x) -> putStrLn x)

H.performR ([r| 1+()-2 |] >> return () :: R s ()) `Control.Exception.catch` (\(H.RError x) -> putStrLn x)

-- XXX This is another workaround to avoid the test hanging on windows.
-- For some reason, if the output of ghci is redirected and the last
-- command in the test is `testpm x`, then ghci executes all commands
-- but does not produce any R output and seems to block forever.
--
-- Running R in the main thread does not seem to block this test.
H.performR $ H.print =<< [r| 2 |]
